<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Orange Pi WiFi Setup</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
  <div class="container">
    <h1>üì° Wi-Fi –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h1>

    <button onclick="scanWifi()">üîç –°–∫–∞–Ω—É–≤–∞—Ç–∏ Wi-Fi</button>

    <ul id="wifi-list"></ul>

    <input id="ssid" placeholder="SSID" readonly>
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="connect()">üîó –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å</button>

    <hr>

    <h3>–ú–µ—Ä–µ–∂–µ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>

    <button id="static-ip-btn">
      –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω–∏–π IP
    </button>

    <p id="static-ip-status"></p>

    <hr>

    <h3>–ú–µ—Ä–µ–∂–µ–≤—ñ –¥—ñ—ó</h3>

    <button id="dhcp-btn">
      –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ DHCP
    </button>

    <p id="dhcp-status"></p>

    <hr>

    <h3>–ü–æ—Ç–æ—á–Ω—ñ –º–µ—Ä–µ–∂–µ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>

    <div id="net-info">
      <div>IP: <span id="cur-ip">‚Äî</span></div>
      <div>Gateway: <span id="cur-gw">‚Äî</span></div>
      <div>DNS: <span id="cur-dns">‚Äî</span></div>
    </div>
  </div>

<script>
  let autoScanTimer = null;

  function signalIcon(level) {
    if (level > 80) return "‚ñÇ‚ñÑ‚ñÜ‚ñà";
    if (level > 60) return "‚ñÇ‚ñÑ‚ñÜ";
    if (level > 40) return "‚ñÇ‚ñÑ";
    return "‚ñÇ";
  }

  function scanWifi() {
    fetch("/scan")
      .then(r => r.json())
      .then(data => {
        const list = document.getElementById("wifi-list");
        list.innerHTML = "";

        data.forEach(net => {
          const li = document.createElement("li");
          if (net.in_use) li.classList.add("active");

          li.onclick = () => {
            document.getElementById("ssid").value = net.ssid;
          };

          li.innerHTML = `
            <div>
              <div class="ssid">
                ${net.ssid}
                ${net.secure ? "üîí" : ""}
                ${net.in_use ? " ‚≠ê" : ""}
              </div>
              <div class="meta">${net.signal}%</div>
            </div>
            <div class="signal">${signalIcon(net.signal)}</div>
          `;

          list.appendChild(li);
        });
      });
  }

  /* üîÑ –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥ */
  function startAutoScan() {
    scanWifi();
    autoScanTimer = setInterval(scanWifi, 10000);
  }

  window.onload = startAutoScan;
</script>

<script>
document.getElementById("static-ip-btn").onclick = async () => {
  const res = await fetch("/set_static_ip", { method: "POST" });
  const data = await res.json();
  document.getElementById("static-ip-status").innerText = data.message;
};
</script>

<script>
document.getElementById("dhcp-btn").onclick = async () => {
  document.getElementById("dhcp-status").innerText = "–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è DHCP...";
  try {
    const r = await fetch("/set_dhcp", { method: "POST" });
    const d = await r.json();
    document.getElementById("dhcp-status").innerText = d.message;
  } catch {
    document.getElementById("dhcp-status").innerText = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É";
  }
};
</script>

<script>
  async function loadNetStatus() {
    try {
      const r = await fetch("/network_status");
      const d = await r.json();

      document.getElementById("cur-ip").innerText = d.ip || "‚Äî";
      document.getElementById("cur-gw").innerText = d.gateway || "‚Äî";
      document.getElementById("cur-dns").innerText = d.dns || "‚Äî";
    } catch {
      document.getElementById("cur-ip").innerText = "error";
    }
  }

  loadNetStatus();
  setInterval(loadNetStatus, 5000);
</script>
</body>
</html>
